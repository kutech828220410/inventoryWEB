<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>GATT 條碼掃描接收</title>
</head>
<body>
  <h1>GATT 模式接收條碼資料</h1>
  <button id="connect">連接條碼機</button>
  <div id="status">尚未連接</div>
  <div id="data">等待資料...</div>

  <script>
    const status = document.getElementById('status');
    const data = document.getElementById('data');

    document.getElementById('connect').addEventListener('click', async () => {
      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'Barcode' }], // 或直接用 name, services 等
          optionalServices: ['battery_service', '0000ffe0-0000-1000-8000-00805f9b34fb'] // 你的條碼機服務 UUID
        });

        status.textContent = `已選擇裝置：${device.name}`;

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService('0000ffe0-0000-1000-8000-00805f9b34fb'); // 請替換成你條碼機的 Service UUID
        const characteristic = await service.getCharacteristic('0000ffe1-0000-1000-8000-00805f9b34fb'); // 請替換成接收資料的 Characteristic UUID

        await characteristic.startNotifications();
        status.textContent = `已連接，等待條碼資料...`;

        characteristic.addEventListener('characteristicvaluechanged', (event) => {
          const value = new TextDecoder().decode(event.target.value);
          console.log('接收到條碼：', value);
          data.textContent = `掃描資料：${value}`;
        });
      } catch (err) {
        console.error(err);
        status.textContent = `錯誤：${err.message}`;
      }
    });
  </script>
</body>
</html>
